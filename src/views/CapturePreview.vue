<template>
    <div @click.stop="bgClick()" class="capture-preview">
        <div class="top-section">
            <div class="side-image-container">
                <button @click="back()"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none">
                        <mask id="mask0_81_1024" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24"
                            height="24">
                            <rect width="24" height="24" fill="#D9D9D9" />
                        </mask>
                        <g mask="url(#mask0_81_1024)">
                            <path d="M7.825 13L13.425 18.6L12 20L4 12L12 4L13.425 5.4L7.825 11H20V13H7.825Z"
                                fill="#111111" />
                        </g>
                    </svg></button>
            </div>
            <div class="text-container1">
                <p>사진 촬영 프리뷰</p>
            </div>
        </div>
        <div @click.stop="bgClick()" ref="konvaContainer" class="konva-container"></div>
        <div class="footer">
            <button @click.stop="showToolbox = true"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"
                    viewBox="0 0 28 28" fill="none">
                    <mask id="mask0_80_196" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="28"
                        height="28">
                        <rect width="28" height="28" fill="#D9D9D9" />
                    </mask>
                    <g mask="url(#mask0_80_196)">
                        <path
                            d="M14.7 19.5854L24.4271 9.85832L22.8083 8.23957L13.0812 17.9667L14.7 19.5854ZM3.42706 17.675C3.42706 18.2389 3.6288 18.6861 4.03227 19.0167C4.43574 19.3472 5.0847 19.566 5.97915 19.6729C6.27081 19.7118 6.50658 19.8455 6.68644 20.0739C6.8663 20.3024 6.94651 20.5625 6.92706 20.8542C6.90762 21.1555 6.79095 21.4059 6.57706 21.6052C6.36317 21.8045 6.1104 21.8847 5.81873 21.8458C4.29234 21.6417 3.14755 21.1944 2.38435 20.5042C1.62116 19.8139 1.23956 18.8708 1.23956 17.675C1.23956 16.4305 1.75241 15.4219 2.7781 14.6489C3.8038 13.876 5.23054 13.4118 7.05831 13.2562C7.84581 13.1979 8.43401 13.0691 8.8229 12.8698C9.21178 12.6705 9.40623 12.3958 9.40623 12.0458C9.40623 11.6083 9.19963 11.2608 8.78644 11.0031C8.37324 10.7455 7.69512 10.5437 6.75206 10.3979C6.4604 10.359 6.2222 10.2205 6.03748 9.98228C5.85276 9.74408 5.77984 9.47915 5.81873 9.18749C5.85762 8.8861 5.98887 8.64061 6.21248 8.45103C6.43609 8.26145 6.69373 8.1861 6.9854 8.22499C8.54095 8.46804 9.6979 8.90068 10.4562 9.5229C11.2146 10.1451 11.5937 10.9861 11.5937 12.0458C11.5937 13.0278 11.217 13.8128 10.4635 14.401C9.71005 14.9892 8.63331 15.3368 7.23331 15.4437C5.96942 15.541 5.01908 15.7767 4.38227 16.151C3.74547 16.5253 3.42706 17.0333 3.42706 17.675ZM15.225 22.1521L10.5146 17.4417L21.5833 6.3729C21.9236 6.03263 22.3319 5.86249 22.8083 5.86249C23.2847 5.86249 23.6979 6.03263 24.0479 6.3729L26.3083 8.61874C26.6583 8.95902 26.8333 9.36735 26.8333 9.84374C26.8333 10.3201 26.6583 10.7333 26.3083 11.0833L15.225 22.1521ZM10.6021 23.1146C10.3007 23.1826 10.0333 23.1 9.79998 22.8667C9.56665 22.6333 9.48401 22.366 9.55206 22.0646L10.5146 17.4417L15.225 22.1521L10.6021 23.1146Z"
                            fill="black" />
                    </g>
                </svg>편집</button>
            <button @click.stop="saveImage()"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"
                    viewBox="0 0 28 28" fill="none">
                    <mask id="mask0_80_189" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="28"
                        height="28">
                        <rect width="28" height="28" fill="#D9D9D9" />
                    </mask>
                    <g mask="url(#mask0_80_189)">
                        <path
                            d="M14 18.0687C13.8542 18.0687 13.7156 18.042 13.5844 17.9885C13.4531 17.9351 13.334 17.8549 13.2271 17.7479L9.17293 13.6937C8.95904 13.4799 8.85452 13.2271 8.85939 12.9354C8.86425 12.6437 8.96876 12.391 9.17293 12.1771C9.38682 11.9632 9.64202 11.8538 9.93855 11.849C10.2351 11.8441 10.4903 11.9486 10.7042 12.1625L12.9063 14.3646V6.05208C12.9063 5.75069 13.0132 5.49305 13.2271 5.27916C13.441 5.06527 13.6986 4.95833 14 4.95833C14.3014 4.95833 14.559 5.06527 14.7729 5.27916C14.9868 5.49305 15.0938 5.75069 15.0938 6.05208V14.3646L17.2958 12.1625C17.5097 11.9486 17.7649 11.8441 18.0615 11.849C18.358 11.8538 18.6132 11.9632 18.8271 12.1771C19.0313 12.391 19.1358 12.6437 19.1406 12.9354C19.1455 13.2271 19.041 13.4799 18.8271 13.6937L14.7729 17.7479C14.666 17.8549 14.5469 17.9351 14.4156 17.9885C14.2844 18.042 14.1458 18.0687 14 18.0687ZM7.14584 23.0417C6.54307 23.0417 6.02779 22.8278 5.60001 22.4C5.17223 21.9722 4.95834 21.4569 4.95834 20.8542V18.5208C4.95834 18.2194 5.06529 17.9618 5.27918 17.7479C5.49307 17.534 5.7507 17.4271 6.05209 17.4271C6.35348 17.4271 6.61112 17.534 6.82501 17.7479C7.0389 17.9618 7.14584 18.2194 7.14584 18.5208V20.8542H20.8542V18.5208C20.8542 18.2194 20.9611 17.9618 21.175 17.7479C21.3889 17.534 21.6465 17.4271 21.9479 17.4271C22.2493 17.4271 22.507 17.534 22.7208 17.7479C22.9347 17.9618 23.0417 18.2194 23.0417 18.5208V20.8542C23.0417 21.4569 22.8278 21.9722 22.4 22.4C21.9722 22.8278 21.457 23.0417 20.8542 23.0417H7.14584Z"
                            fill="black" />
                    </g>
                </svg>다운로드</button>
            <button @click.stop="toggleFooter2()"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"
                    viewBox="0 0 28 28" fill="none">
                    <mask id="mask0_80_203" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="28"
                        height="28">
                        <rect width="28" height="28" fill="#D9D9D9" />
                    </mask>
                    <g mask="url(#mask0_80_203)">
                        <path
                            d="M20.4392 24.7794C19.5242 24.7794 18.7475 24.4595 18.1092 23.8196C17.4709 23.1797 17.1518 22.4028 17.1518 21.4887C17.1518 21.3569 17.1612 21.2205 17.1801 21.0795C17.1991 20.9384 17.2274 20.8114 17.2653 20.6985L9.29362 16.0702C8.98156 16.3634 8.63214 16.5879 8.24534 16.744C7.85854 16.9 7.45332 16.978 7.02968 16.978C6.10871 16.978 5.32908 16.6567 4.69078 16.0141C4.05249 15.3714 3.73334 14.5911 3.73334 13.673C3.73334 12.7629 4.05327 11.9892 4.69314 11.3521C5.33303 10.715 6.11002 10.3965 7.02412 10.3965C7.45241 10.3965 7.86208 10.4721 8.25314 10.6234C8.64419 10.7747 8.99102 10.9922 9.29362 11.2759L17.2653 6.64763C17.2274 6.53474 17.1991 6.40774 17.1801 6.26664C17.1612 6.12555 17.1518 5.98915 17.1518 5.85745C17.1518 4.94335 17.472 4.16635 18.1126 3.52647C18.7531 2.8866 19.5309 2.56667 20.4459 2.56667C21.3609 2.56667 22.1376 2.88523 22.7759 3.52235C23.4142 4.15946 23.7333 4.9331 23.7333 5.84326C23.7333 6.76131 23.4134 7.54165 22.7735 8.18428C22.1336 8.82691 21.3567 9.14823 20.4426 9.14823C20.0176 9.14823 19.6111 9.07021 19.2231 8.91418C18.8351 8.75815 18.4851 8.53357 18.1731 8.24042L10.2014 12.8645C10.2392 12.9834 10.2676 13.1172 10.2865 13.2658C10.3054 13.4144 10.3149 13.5545 10.3149 13.6862C10.3149 13.818 10.3054 13.9544 10.2865 14.0955C10.2676 14.2366 10.2392 14.3637 10.2014 14.4766L18.1731 19.1057C18.4851 18.8125 18.8345 18.5879 19.2213 18.4319C19.6081 18.2759 20.0134 18.1979 20.437 18.1979C21.358 18.1979 22.1376 18.5192 22.7759 19.1618C23.4142 19.8044 23.7333 20.5848 23.7333 21.5028C23.7333 22.413 23.4131 23.1866 22.7725 23.8237C22.132 24.4609 21.3543 24.7794 20.4392 24.7794ZM20.4426 7.02057C20.7641 7.02057 21.0383 6.90709 21.2653 6.68014C21.4922 6.45319 21.6057 6.17896 21.6057 5.85745C21.6057 5.53593 21.4922 5.2617 21.2653 5.03475C21.0383 4.8078 20.7641 4.69432 20.4426 4.69432C20.121 4.69432 19.8468 4.8078 19.6199 5.03475C19.3929 5.2617 19.2794 5.53593 19.2794 5.85745C19.2794 6.17896 19.3929 6.45319 19.6199 6.68014C19.8468 6.90709 20.121 7.02057 20.4426 7.02057ZM7.02412 14.8504C7.34563 14.8504 7.61986 14.7369 7.84681 14.5099C8.07376 14.283 8.18724 14.0087 8.18724 13.6872C8.18724 13.3657 8.07376 13.0915 7.84681 12.8645C7.61986 12.6376 7.34563 12.5241 7.02412 12.5241C6.7026 12.5241 6.42837 12.6376 6.20142 12.8645C5.97447 13.0915 5.861 13.3657 5.861 13.6872C5.861 14.0087 5.97447 14.283 6.20142 14.5099C6.42837 14.7369 6.7026 14.8504 7.02412 14.8504ZM20.4426 22.6518C20.7641 22.6518 21.0383 22.5383 21.2653 22.3113C21.4922 22.0844 21.6057 21.8102 21.6057 21.4887C21.6057 21.1671 21.4922 20.8929 21.2653 20.666C21.0383 20.439 20.7641 20.3255 20.4426 20.3255C20.121 20.3255 19.8468 20.439 19.6199 20.666C19.3929 20.8929 19.2794 21.1671 19.2794 21.4887C19.2794 21.8102 19.3929 22.0844 19.6199 22.3113C19.8468 22.5383 20.121 22.6518 20.4426 22.6518Z"
                            fill="black" />
                    </g>
                </svg>공유</button>
        </div>
        <div v-show="showFooter2" class="footer2">
            <p>공유 방법을 선택해 주세요.</p>
            <!-- <button @click="editor()">방명록에 공유하기</button> -->
            <button @click="share()">SNS에 공유하기</button>
            <button @click="next()">참여하지 않고 나가기</button>
        </div>
        <div v-if="showModal" class="modal">
            <p>사진 촬영으로 돌아갑니다.</p>
            <div class="modal-buttons">
                <button @click="closeModal">취소</button>
                <button @click="confirmBack">확인</button>
            </div>
        </div>
        <div v-if="showToolbox" class="toolbox">
            <div class="top-section2">
                <div class="left">
                    <button @click="activateTool('draw')" :class="{ active: currentTool === 'draw' }"><svg
                            xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <mask id="mask0_80_321" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                                width="24" height="24">
                                <rect width="24" height="24" fill="#D9D9D9" />
                            </mask>
                            <g mask="url(#mask0_80_321)">
                                <path
                                    d="M12.5375 16.7625L20.875 8.425L19.4875 7.0375L11.15 15.375L12.5375 16.7625ZM2.875 15.125C2.875 15.6083 3.04792 15.9917 3.39375 16.275C3.73958 16.5583 4.29583 16.7458 5.0625 16.8375C5.3125 16.8708 5.51458 16.9854 5.66875 17.1813C5.82292 17.3771 5.89167 17.6 5.875 17.85C5.85833 18.1083 5.75833 18.3229 5.575 18.4938C5.39167 18.6646 5.175 18.7333 4.925 18.7C3.61667 18.525 2.63542 18.1417 1.98125 17.55C1.32708 16.9583 1 16.15 1 15.125C1 14.0583 1.43958 13.1938 2.31875 12.5312C3.19792 11.8688 4.42083 11.4708 5.9875 11.3375C6.6625 11.2875 7.16667 11.1771 7.5 11.0062C7.83333 10.8354 8 10.6 8 10.3C8 9.925 7.82292 9.62708 7.46875 9.40625C7.11458 9.18542 6.53333 9.0125 5.725 8.8875C5.475 8.85417 5.27083 8.73542 5.1125 8.53125C4.95417 8.32708 4.89167 8.1 4.925 7.85C4.95833 7.59167 5.07083 7.38125 5.2625 7.21875C5.45417 7.05625 5.675 6.99167 5.925 7.025C7.25833 7.23333 8.25 7.60417 8.9 8.1375C9.55 8.67083 9.875 9.39167 9.875 10.3C9.875 11.1417 9.55208 11.8146 8.90625 12.3187C8.26042 12.8229 7.3375 13.1208 6.1375 13.2125C5.05417 13.2958 4.23958 13.4979 3.69375 13.8188C3.14792 14.1396 2.875 14.575 2.875 15.125ZM12.9875 18.9625L8.95 14.925L18.4375 5.4375C18.7292 5.14583 19.0792 5 19.4875 5C19.8958 5 20.25 5.14583 20.55 5.4375L22.4875 7.3625C22.7875 7.65417 22.9375 8.00417 22.9375 8.4125C22.9375 8.82083 22.7875 9.175 22.4875 9.475L12.9875 18.9625ZM9.025 19.7875C8.76667 19.8458 8.5375 19.775 8.3375 19.575C8.1375 19.375 8.06667 19.1458 8.125 18.8875L8.95 14.925L12.9875 18.9625L9.025 19.7875Z"
                                    fill="black" fill-opacity="0.3" />
                            </g>
                        </svg>그리기</button>
                    <button @click="activateTool('text'), addText()" :class="{ active: currentTool === 'text' }"><svg
                            xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <mask id="mask0_80_328" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                                width="24" height="24">
                                <rect width="24" height="24" fill="#D9D9D9" />
                            </mask>
                            <g mask="url(#mask0_80_328)">
                                <path
                                    d="M12.9375 19.775V20.8125C12.9375 21.0708 12.8458 21.2917 12.6625 21.475C12.4791 21.6583 12.2583 21.75 12 21.75C11.7416 21.75 11.5208 21.6583 11.3375 21.475C11.1541 21.2917 11.0625 21.0708 11.0625 20.8125V16.875C11.0625 16.6167 11.1541 16.3958 11.3375 16.2125C11.5208 16.0292 11.7416 15.9375 12 15.9375C12.2583 15.9375 12.4791 16.0292 12.6625 16.2125C12.8458 16.3958 12.9375 16.6167 12.9375 16.875V17.9H19.8375C20.0958 17.9 20.3166 17.9917 20.5 18.175C20.6833 18.3583 20.775 18.5792 20.775 18.8375C20.775 19.0958 20.6833 19.3167 20.5 19.5C20.3166 19.6833 20.0958 19.775 19.8375 19.775H12.9375ZM4.16248 19.775C3.90414 19.775 3.68331 19.6833 3.49998 19.5C3.31664 19.3167 3.22498 19.0958 3.22498 18.8375C3.22498 18.5792 3.31664 18.3583 3.49998 18.175C3.68331 17.9917 3.90414 17.9 4.16248 17.9H8.24998C8.50831 17.9 8.72914 17.9917 8.91248 18.175C9.09581 18.3583 9.18748 18.5792 9.18748 18.8375C9.18748 19.0958 9.09581 19.3167 8.91248 19.5C8.72914 19.6833 8.50831 19.775 8.24998 19.775H4.16248ZM9.62498 10.9875H14.3875L15.2375 13.4125C15.3041 13.5875 15.4146 13.7292 15.5687 13.8375C15.7229 13.9458 15.8958 14 16.0875 14C16.4041 14 16.6562 13.8667 16.8437 13.6C17.0312 13.3333 17.0625 13.05 16.9375 12.75L13.2125 2.85C13.1375 2.66667 13.025 2.52083 12.875 2.4125C12.725 2.30417 12.55 2.25 12.35 2.25H11.65C11.45 2.25 11.275 2.30417 11.125 2.4125C10.975 2.52083 10.8625 2.66667 10.7875 2.85L7.03748 12.775C6.92914 13.075 6.96456 13.3542 7.14373 13.6125C7.32289 13.8708 7.57081 14 7.88748 14C8.08748 14 8.26456 13.9458 8.41873 13.8375C8.57289 13.7292 8.68748 13.5792 8.76248 13.3875L9.62498 10.9875ZM10.2 9.35L11.95 4.3875H12.05L13.8 9.35H10.2Z"
                                    fill="black" fill-opacity="0.3" />
                            </g>
                        </svg>텍스트</button>
                </div>
                <div class="right">
                    <div v-if="currentTool === 'draw'" class="top-buttons">
                        <button @click="setDrawingTool('pen')" :class="{ active: currentDrawingTool === 'pen' }"><svg
                                xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <mask id="mask0_80_274" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                                    width="20" height="20">
                                    <rect width="20" height="20" fill="#D9D9D9" />
                                </mask>
                                <g mask="url(#mask0_80_274)">
                                    <path
                                        d="M10.1875 9.08333L10.9375 9.83333L15.4166 5.35417L14.6666 4.60417L10.1875 9.08333ZM4.26038 15.75H5.02079L9.83329 10.9375L9.08329 10.1875L4.26038 15.0104V15.75ZM11.5 11.4896L8.53121 8.52083L11.9895 5.0625L11.3958 4.46875L7.45829 8.38542C7.3011 8.54514 7.1177 8.625 6.90811 8.625C6.69851 8.625 6.51732 8.54514 6.36454 8.38542C6.21177 8.22569 6.13538 8.04016 6.13538 7.82881C6.13538 7.61748 6.21177 7.43496 6.36454 7.28125L10.2581 3.40615C10.586 3.07983 10.967 2.91667 11.401 2.91667C11.835 2.91667 12.2152 3.07986 12.5416 3.40625L13.0937 3.95833L14.0915 2.95867C14.2512 2.79872 14.4407 2.71875 14.6603 2.71875C14.8798 2.71875 15.0682 2.79819 15.2256 2.95708L17.0555 4.80417C17.2129 4.96306 17.2916 5.15174 17.2916 5.37021C17.2916 5.58868 17.2118 5.77778 17.052 5.9375L11.5 11.4896ZM3.47913 17.3125C3.26385 17.3125 3.07982 17.2361 2.92704 17.0833C2.77426 16.9306 2.69788 16.7465 2.69788 16.5313V15.0047C2.69788 14.7932 2.73773 14.5918 2.81744 14.4005C2.89715 14.2092 3.01007 14.041 3.15621 13.8958L8.53121 8.52083L11.5 11.4896L6.13538 16.8542C5.99078 17.0003 5.82318 17.1132 5.63258 17.1929C5.44199 17.2726 5.24153 17.3125 5.03121 17.3125H3.47913Z"
                                        fill="black" fill-opacity="0.3" />
                                </g>
                            </svg>
                            펜</button>
                        <button @click="setDrawingTool('highlighter')"
                            :class="{ active: currentDrawingTool === 'highlighter' }"><svg
                                xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <mask id="mask0_80_278" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                                    width="20" height="20">
                                    <rect width="20" height="20" fill="#D9D9D9" />
                                </mask>
                                <g mask="url(#mask0_80_278)">
                                    <path
                                        d="M5.7292 17.6042L4.95836 16.8333L4.12503 17.6875C3.88198 17.9306 3.58163 18.0538 3.22399 18.0573C2.86635 18.0608 2.56948 17.9375 2.33336 17.6875C2.09031 17.4375 1.96704 17.1389 1.96357 16.7917C1.9601 16.4444 2.08336 16.1458 2.33336 15.8958L3.1667 15.0417L2.39586 14.2292L13.6667 2.95833C13.8264 2.79861 14.0209 2.71875 14.25 2.71875C14.4792 2.71875 14.6736 2.79861 14.8334 2.95833L17.0417 5.16667C17.2014 5.32639 17.2813 5.52083 17.2813 5.75C17.2813 5.97917 17.2014 6.17361 17.0417 6.33333L5.7292 17.6042ZM9.27086 9.60417L4.58336 14.2292L5.75003 15.3958L10.4167 10.75L9.27086 9.60417Z"
                                        fill="black" fill-opacity="0.3" />
                                </g>
                            </svg>형광펜</button>
                        <button @click="setDrawingTool('eraser')" :class="{ active: currentDrawingTool === 'eraser' }"><svg
                                xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <mask id="mask0_80_282" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                                    width="20" height="20">
                                    <rect width="20" height="20" fill="#D9D9D9" />
                                </mask>
                                <g mask="url(#mask0_80_282)">
                                    <path
                                        d="M14.2708 14.9167H17.3854C17.6007 14.9167 17.7847 14.9931 17.9375 15.1458C18.0902 15.2986 18.1666 15.4826 18.1666 15.6979C18.1666 15.9132 18.0902 16.0972 17.9375 16.25C17.7847 16.4028 17.6007 16.4792 17.3854 16.4792H12.7083L14.2708 14.9167ZM4.36454 16.4792C4.26301 16.4792 4.16465 16.4601 4.06946 16.4219C3.97428 16.3837 3.88861 16.3264 3.81246 16.25L2.31246 14.75C2.01297 14.4516 1.85998 14.0819 1.85348 13.6408C1.84697 13.1997 1.99301 12.8264 2.29163 12.5208L11.3333 3.14583C11.6314 2.84028 11.9976 2.6875 12.4319 2.6875C12.8662 2.6875 13.2326 2.83681 13.5312 3.13542L17.6145 7.21875C17.9132 7.51736 18.0642 7.88715 18.0677 8.32813C18.0711 8.7691 17.9236 9.13889 17.625 9.4375L10.9791 16.2396C10.9027 16.316 10.8159 16.375 10.7185 16.4167C10.6211 16.4583 10.5205 16.4792 10.4166 16.4792H4.36454ZM10.0813 14.9167L16.5208 8.29167L12.4583 4.22917L3.37496 13.6013L4.70829 14.9167H10.0813Z"
                                        fill="black" fill-opacity="0.3" />
                                </g>
                            </svg>지우개</button>
                    </div>
                    <div v-if="currentTool === 'text'" class="top-buttons">
                        <button @click="setTextTool('normal')" :class="{ active: currentTextTool === 'normal' }"><svg
                                xmlns="http://www.w3.org/2000/svg" width="14" height="10" viewBox="0 0 14 10" fill="none">
                                <path
                                    d="M2.49996 6.96876L1.88538 8.67709C1.84371 8.80209 1.77253 8.90105 1.67184 8.97396C1.57114 9.04688 1.45482 9.08334 1.32288 9.08334C1.1076 9.08334 0.935725 8.9948 0.807252 8.81771C0.67878 8.64063 0.652738 8.44792 0.729127 8.23959L3.31246 1.34376C3.36107 1.21181 3.4392 1.10764 3.54684 1.03126C3.65447 0.954866 3.77774 0.916672 3.91663 0.916672H4.41663C4.55552 0.916672 4.68052 0.954866 4.79163 1.03126C4.90274 1.10764 4.9826 1.21181 5.03121 1.34376L7.61454 8.23959C7.69093 8.44792 7.66836 8.64063 7.54684 8.81771C7.42531 8.9948 7.25343 9.08334 7.03121 9.08334C6.89232 9.08334 6.76732 9.04515 6.65621 8.96876C6.5451 8.89237 6.46524 8.7882 6.41663 8.65626L5.83329 6.96876H2.49996ZM2.91663 5.84376H5.42704L4.20829 2.35417H4.13538L2.91663 5.84376ZM10.6041 9.30209C9.97218 9.30209 9.46177 9.12327 9.07288 8.76563C8.68399 8.40799 8.48954 7.94098 8.48954 7.36459C8.48954 6.78126 8.70829 6.31077 9.14579 5.95313C9.58329 5.59549 10.1562 5.41667 10.8645 5.41667C11.1562 5.41667 11.4409 5.44445 11.7187 5.50001C11.9965 5.55556 12.2326 5.63542 12.427 5.73959V5.40626C12.427 5.03126 12.3003 4.73264 12.0468 4.51042C11.7934 4.2882 11.4479 4.17709 11.0104 4.17709C10.7951 4.17709 10.592 4.20834 10.401 4.27084C10.21 4.33334 10.0347 4.42362 9.87496 4.54167C9.7569 4.63195 9.6267 4.68056 9.48433 4.68751C9.34197 4.69445 9.21177 4.65278 9.09371 4.56251C8.97565 4.47223 8.90621 4.35591 8.88538 4.21355C8.86454 4.07119 8.90968 3.95139 9.02079 3.85417C9.28468 3.61806 9.58503 3.44098 9.92184 3.32292C10.2586 3.20487 10.6354 3.14584 11.052 3.14584C11.8645 3.14584 12.4895 3.34896 12.927 3.75521C13.3645 4.16146 13.5833 4.74306 13.5833 5.50001V8.64584C13.5833 8.80556 13.5295 8.93924 13.4218 9.04688C13.3142 9.15452 13.1805 9.20834 13.0208 9.20834C12.8611 9.20834 12.7239 9.15105 12.6093 9.03646C12.4948 8.92188 12.4375 8.78473 12.4375 8.62501V8.39584H12.375C12.1944 8.68056 11.9513 8.90278 11.6458 9.06251C11.3402 9.22223 10.993 9.30209 10.6041 9.30209ZM10.8125 8.32292C11.2638 8.32292 11.6458 8.1632 11.9583 7.84376C12.2708 7.52431 12.427 7.13542 12.427 6.67709C12.2395 6.56598 12.0191 6.48264 11.7656 6.42709C11.5121 6.37153 11.2743 6.34376 11.052 6.34376C10.6215 6.34376 10.2882 6.4323 10.052 6.60938C9.81593 6.78646 9.69788 7.03473 9.69788 7.35417C9.69788 7.63889 9.80204 7.87153 10.0104 8.05209C10.2187 8.23264 10.4861 8.32292 10.8125 8.32292Z"
                                    fill="black" />
                            </svg>일반</button>
                        <button @click="setTextTool('bold')" :class="{ active: currentTextTool === 'bold' }"><svg
                                xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <mask id="mask0_80_374" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                                    width="20" height="20">
                                    <rect width="20" height="20" fill="#D9D9D9" />
                                </mask>
                                <g mask="url(#mask0_80_374)">
                                    <path
                                        d="M7.36462 15.75C6.93407 15.75 6.56601 15.5972 6.26046 15.2917C5.9549 14.9861 5.80212 14.6181 5.80212 14.1875V5.8125C5.80212 5.38194 5.9549 5.01389 6.26046 4.70833C6.56601 4.40278 6.93407 4.25 7.36462 4.25H10.2709C11.1806 4.25 11.9966 4.52604 12.7188 5.07812C13.441 5.63021 13.8021 6.37153 13.8021 7.30208C13.8021 7.92014 13.6511 8.43924 13.349 8.85938C13.0469 9.27951 12.7049 9.57986 12.323 9.76042V9.82292C12.7952 9.97569 13.2257 10.2812 13.6146 10.7396C14.0035 11.1979 14.198 11.7917 14.198 12.5208C14.198 13.5972 13.7882 14.4045 12.9688 14.9427C12.1493 15.4809 11.2987 15.75 10.4167 15.75H7.36462ZM8.02087 13.7292H10.3125C10.8959 13.7292 11.3177 13.5677 11.5782 13.2448C11.8386 12.9219 11.9688 12.6007 11.9688 12.2812C11.9688 11.9618 11.8386 11.6406 11.5782 11.3177C11.3177 10.9948 10.8855 10.8333 10.2813 10.8333H8.02087V13.7292ZM8.02087 8.89583H10.1146C10.573 8.89583 10.9393 8.76562 11.2136 8.50521C11.4879 8.24479 11.625 7.93056 11.625 7.5625C11.625 7.17361 11.4809 6.8559 11.1927 6.60938C10.9046 6.36285 10.5521 6.23958 10.1355 6.23958H8.02087V8.89583Z"
                                        fill="black" />
                                </g>
                            </svg>굵게</button>
                        <button @click="setTextTool('underline')" :class="{ active: currentTextTool === 'underline' }"><svg
                                xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <mask id="mask0_80_378" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                                    width="20" height="20">
                                    <rect width="20" height="20" fill="#D9D9D9" />
                                </mask>
                                <g mask="url(#mask0_80_378)">
                                    <path
                                        d="M5.09375 15.7083C4.87847 15.7083 4.69444 15.6319 4.54167 15.4792C4.38889 15.3264 4.3125 15.1424 4.3125 14.9271C4.3125 14.7118 4.38889 14.5278 4.54167 14.375C4.69444 14.2222 4.87847 14.1458 5.09375 14.1458H14.9271C15.1424 14.1458 15.3264 14.2222 15.4792 14.375C15.6319 14.5278 15.7083 14.7118 15.7083 14.9271C15.7083 15.1424 15.6319 15.3264 15.4792 15.4792C15.3264 15.6319 15.1424 15.7083 14.9271 15.7083H5.09375ZM8.65625 8.8125H11.3646L10.0521 5.08333H9.96875L8.65625 8.8125ZM6.95833 12.3333C6.66667 12.3333 6.45312 12.2378 6.31771 12.0469C6.18229 11.8559 6.17014 11.625 6.28125 11.3542L8.97917 4.17708C9.05556 3.98263 9.19444 3.81423 9.39583 3.67187C9.59722 3.52951 9.80556 3.45833 10.0208 3.45833C10.2361 3.45833 10.4427 3.52951 10.6406 3.67187C10.8385 3.81423 10.9757 3.98263 11.0521 4.17708L13.7396 11.3542C13.8507 11.625 13.8385 11.8559 13.7031 12.0469C13.5677 12.2378 13.3507 12.3333 13.0521 12.3333C12.9271 12.3333 12.8073 12.2951 12.6927 12.2187C12.5781 12.1424 12.5035 12.0451 12.4688 11.9271L11.8333 10.0625H8.22917L7.55208 11.9271C7.51042 12.0451 7.43403 12.1424 7.32292 12.2187C7.21181 12.2951 7.09028 12.3333 6.95833 12.3333Z"
                                        fill="black" />
                                </g>
                            </svg>밑줄</button>
                    </div>
                    <div class="color-palette">
                        <div class="color-row" v-for="row in 2" :key="row">
                            <div v-for="color in colors.slice((row - 1) * 5, row * 5)" :key="color"
                                :style="{ backgroundColor: color }" @click="setColor(color)"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bottom-buttons">
                <button @click="undo"><svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 44 44"
                        fill="none">
                        <circle cx="22" cy="22" r="22" fill="black" fill-opacity="0.2" />
                        <mask id="mask0_81_990" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="10" y="10" width="24"
                            height="24">
                            <rect x="10" y="10" width="24" height="24" fill="#D9D9D9" />
                        </mask>
                        <g mask="url(#mask0_81_990)">
                            <path
                                d="M18 29C17.7167 29 17.4792 28.9042 17.2875 28.7125C17.0959 28.5208 17 28.2833 17 28C17 27.7167 17.0959 27.4792 17.2875 27.2875C17.4792 27.0958 17.7167 27 18 27H24.1C25.15 27 26.0625 26.6667 26.8375 26C27.6125 25.3333 28 24.5 28 23.5C28 22.5 27.6125 21.6667 26.8375 21C26.0625 20.3333 25.15 20 24.1 20H17.8L19.7 21.9C19.8834 22.0833 19.975 22.3167 19.975 22.6C19.975 22.8833 19.8834 23.1167 19.7 23.3C19.5167 23.4833 19.2834 23.575 19 23.575C18.7167 23.575 18.4834 23.4833 18.3 23.3L14.7 19.7C14.6 19.6 14.5292 19.4917 14.4875 19.375C14.4459 19.2583 14.425 19.1333 14.425 19C14.425 18.8667 14.4459 18.7417 14.4875 18.625C14.5292 18.5083 14.6 18.4 14.7 18.3L18.3 14.7C18.4834 14.5167 18.7167 14.425 19 14.425C19.2834 14.425 19.5167 14.5167 19.7 14.7C19.8834 14.8833 19.975 15.1167 19.975 15.4C19.975 15.6833 19.8834 15.9167 19.7 16.1L17.8 18H24.1C25.7167 18 27.1042 18.525 28.2625 19.575C29.4209 20.625 30 21.9333 30 23.5C30 25.0667 29.4209 26.375 28.2625 27.425C27.1042 28.475 25.7167 29 24.1 29H18Z"
                                fill="white" />
                        </g>
                    </svg></button>
                <button @click="redo"><svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 44 44"
                        fill="none">
                        <circle cx="22" cy="22" r="22" fill="black" fill-opacity="0.2" />
                        <mask id="mask0_81_995" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="10" y="10" width="24"
                            height="24">
                            <rect x="10" y="10" width="24" height="24" fill="#D9D9D9" />
                        </mask>
                        <g mask="url(#mask0_81_995)">
                            <path
                                d="M26.2 20H19.9C18.85 20 17.9375 20.3333 17.1625 21C16.3875 21.6667 16 22.5 16 23.5C16 24.5 16.3875 25.3333 17.1625 26C17.9375 26.6667 18.85 27 19.9 27H26C26.2833 27 26.5208 27.0958 26.7125 27.2875C26.9042 27.4792 27 27.7167 27 28C27 28.2833 26.9042 28.5208 26.7125 28.7125C26.5208 28.9042 26.2833 29 26 29H19.9C18.2833 29 16.8958 28.475 15.7375 27.425C14.5792 26.375 14 25.0667 14 23.5C14 21.9333 14.5792 20.625 15.7375 19.575C16.8958 18.525 18.2833 18 19.9 18H26.2L24.3 16.1C24.1167 15.9167 24.025 15.6833 24.025 15.4C24.025 15.1167 24.1167 14.8833 24.3 14.7C24.4833 14.5167 24.7167 14.425 25 14.425C25.2833 14.425 25.5167 14.5167 25.7 14.7L29.3 18.3C29.4 18.4 29.4708 18.5083 29.5125 18.625C29.5542 18.7417 29.575 18.8667 29.575 19C29.575 19.1333 29.5542 19.2583 29.5125 19.375C29.4708 19.4917 29.4 19.6 29.3 19.7L25.7 23.3C25.5167 23.4833 25.2833 23.575 25 23.575C24.7167 23.575 24.4833 23.4833 24.3 23.3C24.1167 23.1167 24.025 22.8833 24.025 22.6C24.025 22.3167 24.1167 22.0833 24.3 21.9L26.2 20Z"
                                fill="white" />
                        </g>
                    </svg></button>
                <button @click="showToolbox = false, drawComplete()" class="right-button"><svg
                        xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 44 44" fill="none">
                        <circle cx="22" cy="22" r="22" fill="#D50F4A" />
                        <mask id="mask0_81_1000" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="10" y="10" width="24"
                            height="24">
                            <rect x="10" y="10" width="24" height="24" fill="#D9D9D9" />
                        </mask>
                        <g mask="url(#mask0_81_1000)">
                            <path
                                d="M19.7248 25.4401L28.4799 16.6849C28.6865 16.4783 28.9319 16.375 29.216 16.375C29.5001 16.375 29.7454 16.4783 29.952 16.6849C30.1587 16.8915 30.262 17.1369 30.262 17.421C30.262 17.7051 30.1587 17.9504 29.952 18.157L20.4479 27.6612C20.2413 27.8678 20.0003 27.9711 19.7248 27.9711C19.4493 27.9711 19.2082 27.8678 19.0016 27.6612L14.5595 23.219C14.3529 23.0124 14.2539 22.767 14.2625 22.483C14.2711 22.1989 14.3787 21.9535 14.5853 21.7469C14.7919 21.5403 15.0373 21.437 15.3214 21.437C15.6055 21.437 15.8508 21.5403 16.0574 21.7469L19.7248 25.4401Z"
                                fill="white" />
                        </g>
                    </svg></button>
            </div>
        </div>
        <div v-if="premiumModal" class="modal2" @click="premiumModal = false">
            <div class="modal-content2">
                <button @click="premiumModal = false" class="close-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24"
                        height="25" viewBox="0 0 24 25" fill="none">
                        <mask id="mask0_253_801" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24"
                            height="25">
                            <rect y="0.0882416" width="24" height="24.2118" fill="#D9D9D9" />
                        </mask>
                        <g mask="url(#mask0_253_801)">
                            <path
                                d="M12 13.6065L7.10005 18.5497C6.91672 18.7347 6.68338 18.8271 6.40005 18.8271C6.11672 18.8271 5.88338 18.7347 5.70005 18.5497C5.51672 18.3648 5.42505 18.1294 5.42505 17.8435C5.42505 17.5577 5.51672 17.3223 5.70005 17.1374L10.6 12.1941L5.70005 7.25089C5.51672 7.06594 5.42505 6.83055 5.42505 6.54471C5.42505 6.25888 5.51672 6.02349 5.70005 5.83854C5.88338 5.65359 6.11672 5.56111 6.40005 5.56111C6.68338 5.56111 6.91672 5.65359 7.10005 5.83854L12 10.7818L16.9 5.83854C17.0834 5.65359 17.3167 5.56111 17.6 5.56111C17.8834 5.56111 18.1167 5.65359 18.3 5.83854C18.4834 6.02349 18.575 6.25888 18.575 6.54471C18.575 6.83055 18.4834 7.06594 18.3 7.25089L13.4 12.1941L18.3 17.1374C18.4834 17.3223 18.575 17.5577 18.575 17.8435C18.575 18.1294 18.4834 18.3648 18.3 18.5497C18.1167 18.7347 17.8834 18.8271 17.6 18.8271C17.3167 18.8271 17.0834 18.7347 16.9 18.5497L12 13.6065Z"
                                fill="#111111" />
                        </g>
                    </svg></button>
                <img :src="premiumImageSrc" />
                <p class="p1">{{ premiumText }}</p>
                <p class="p2">획득기회!</p>
            </div>
        </div>
    </div>
</template>



<script>
import { onMounted, ref, watch } from 'vue';
import router from '../router';
import { useImageDataStore } from '../stores/imageData';
import { useRewardsStore } from '../stores/reward';
import Konva from 'konva';

const coupon2 = new URL('@resource/storageBox/02_Coupon_active.png', import.meta.url).href;
const coupon3 = new URL('@resource/storageBox/03_Coupon_active.png', import.meta.url).href;
const coupon4 = new URL('@resource/storageBox/04_Coupon_active.png', import.meta.url).href;
const iceCream = new URL('@resource/storageBox/IceCream_active.png', import.meta.url).href;

export default {
    name: 'CapturePreview',
    setup() {
        const index = ref(0)
        const imgData = ref('')
        const eventName = ref('')
        const showFooter2 = ref(false);
        const showModal = ref(false);
        const premiumModal = ref(false);
        const premiumImageSrc = ref('');
        const premiumText = ref('');

        const showToolbox = ref(false);
        const currentTool = ref('draw');
        const currentDrawingTool = ref(null);
        const currentTextTool = ref(null);
        const currentColor = ref('black');
        const colors = ['red', 'blue', 'green', 'yellow', 'orange', 'purple', 'brown', 'black', 'white', 'gray'];

        const line = ref(null);
        const isDrawing = ref(false);

        const imageDataStore = useImageDataStore();
        const rewardsStore = useRewardsStore();

        const bgClick = () => {
            if (showFooter2.value) {
                showFooter2.value = false;
            }
        }

        const activateTool = (tool) => {
            currentTool.value = tool;
            if (tool === 'draw') {
                removeInput();
            }
        }

        const setColor = (color) => {
            currentColor.value = color;
            if (currentTool.value === 'text') {
                const input = document.querySelector('input');
                input.focus();
            }
        }

        const setDrawingTool = (tool) => {
            currentDrawingTool.value = tool;
        }

        const setTextTool = (tool) => {
            currentTextTool.value = tool;
            const input = document.querySelector('input');
            input.focus();
        }

        const konvaContainer = ref(null);
        const history = ref([]);
        const historyIndex = ref(-1);
        let stage;
        let layer;
        let drawingLayer;

        const undo = () => {
            removeInput();
            if (historyIndex.value <= 0) return;

            historyIndex.value--;
            const imageObj = new Image();
            imageObj.src = history.value[historyIndex.value];
            imageObj.onload = () => {
                const prevImage = new Konva.Image({
                    x: 0,
                    y: 0,
                    image: imageObj,
                    width: stage.width(),
                    height: stage.height(),
                });
                drawingLayer.destroyChildren();
                drawingLayer.add(prevImage);
                drawingLayer.draw();
            };
        };

        // redo 기능
        const redo = () => {
            removeInput();
            if (historyIndex.value >= history.value.length - 1) return;

            historyIndex.value++;
            const imageObj = new Image();
            imageObj.src = history.value[historyIndex.value];
            imageObj.onload = () => {
                const nextImage = new Konva.Image({
                    x: 0,
                    y: 0,
                    image: imageObj,
                    width: stage.width(),
                    height: stage.height(),
                });
                drawingLayer.destroyChildren();
                drawingLayer.add(nextImage);
                drawingLayer.draw();
            };
        };

        const addHistory = () => {
            if (historyIndex.value < history.value.length - 1) {
                history.value = history.value.slice(0, historyIndex.value + 1);
            }

            history.value.push(drawingLayer.toDataURL());
            historyIndex.value++;
        };


        const back = () => {
            showModal.value = true;
        }

        const confirmBack = () => {
            showModal.value = false;
            router.go(-1)
        }

        const closeModal = () => {
            showModal.value = false;
        }

        const drawComplete = () => {
            removeInput();
            imgData.value = stage.toDataURL();
        }

        const saveImage = () => {
            const link = document.createElement('a');
            link.download = 'image.png';
            link.href = imgData.value;
            link.click();
        }

        const toggleFooter2 = () => {
            if (eventName.value === 'shopping2' || eventName.value === 'culture2' || eventName.value === 'eatingOut2' || eventName.value === 'common4') {
                premiumModal.value = true;
            }

            showFooter2.value = !showFooter2.value;
        }

        const next = () => {
            router.push({ path: '/outro', query: { eventName: router.currentRoute.value.query.eventName } });
        }

        const editor = () => {
            router.push({ path: '/texteditor', query: { eventName: router.currentRoute.value.query.eventName } });
        }

        const share = async () => {
            const blob = await (await fetch(imgData.value)).blob();

            const filesArray = [
                new File([blob], "image.png", {
                    type: blob.type,
                }),
            ];

            const shareData = {
                files: filesArray,
            };
            if (!navigator.share) {
                alert("공유하기 기능을 지원하지 않는 브라우저입니다.");
                return;
            }
            navigator
                .share(shareData)
                .then(() => {
                    console.log("Thanks for sharing!");
                    onShareComplete();
                })
                .catch(console.error);
        }

        const onShareComplete = () => {
            eventName.value = imageDataStore.getEventName();
            if (eventName.value === 'shopping2') {
                imageDataStore.setEventName('shopping2Clear');
                localStorage.setItem('item2', 'true')
            } else if (eventName.value === 'culture2') {
                imageDataStore.setEventName('culture2Clear');
                localStorage.setItem('item4', 'true')
            } else if (eventName.value === 'eatingOut2') {
                imageDataStore.setEventName('eatingOut2Clear');
                localStorage.setItem('item3', 'true')
            } else if (eventName.value === 'common4') {
                imageDataStore.setEventName('common4Clear');
                localStorage.setItem('item1', 'true')
            }

            rewardsStore.setRewardsData();
            router.push('./outro');
        }

        const startDrawing = () => {
            if (!showToolbox.value) return;
            isDrawing.value = true;
            const pos = stage.getPointerPosition();

            line.value = new Konva.Line({
                stroke: currentColor.value,
                strokeWidth: currentDrawingTool.value === 'pen' ? 5 : 15,
                opacity: currentDrawingTool.value === 'highlighter' ? 0.5 : 1,
                globalCompositeOperation: currentDrawingTool.value === 'eraser' ? 'destination-out' : 'source-over',
                points: [pos.x, pos.y],
                draggable: false
            });

            drawingLayer.add(line.value);
        }

        const endDrawing = () => {
            if (!showToolbox.value) return;
            isDrawing.value = false;
            addHistory();
        }

        const draw = () => {
            if (!showToolbox.value) return;
            if (!isDrawing.value) return;
            const pos = stage.getPointerPosition();
            const newPoints = line.value.points().concat([pos.x, pos.y],);
            line.value.points(newPoints);
            layer.batchDraw();
        }

        const removeInput = () => {
            const input = document.querySelector('input');
            if (input) {
                document.body.removeChild(input);
            }
        }

        const addText = () => {
            if (currentTool.value !== 'text') return;



            const input = document.createElement('input');
            input.style.position = 'absolute';
            input.style.top = '50%';
            input.style.left = '50%';
            input.style.transform = 'translate(-50%, -50%)';

            document.body.appendChild(input);
            input.focus();


            input.addEventListener('touchend', function (e) {

                // Prevent the default action to stop scrolling in iOS
                e.preventDefault();

                const text = new Konva.Text({
                    x: 150,
                    y: 250,
                    text: input.value,
                    fontFamily: 'Calibri',
                    fontSize: 30,
                    draggable: true,
                    fill: currentColor.value,
                    fontStyle: currentTextTool.value === 'bold' ? 'bold' : 'normal',
                    textDecoration: currentTextTool.value === 'underline' ? 'underline' : 'none',
                });


                drawingLayer.add(text);
                layer.draw();
                addHistory();
                document.body.removeChild(input);
            });

        };

        const setVH = () => {
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }

        onMounted(() => {
            setVH();
            window.addEventListener('resize', setVH);

            imgData.value = imageDataStore.getImageData();
            eventName.value = imageDataStore.getEventName();

            if (eventName.value === 'shopping2') {
                premiumModal.value = true;
                premiumImageSrc.value = coupon2
                premiumText.value = '패션·잡화 1만원 금액할인권'
            } else if (eventName.value === 'culture2') {
                premiumModal.value = true;
                premiumImageSrc.value = coupon4
                premiumText.value = '몽드이기자 1만원 금액할인권'
            } else if (eventName.value === 'eatingOut2') {
                premiumModal.value = true;
                premiumImageSrc.value = coupon3
                premiumText.value = 'F&B 5천원 금액할인권'
            } else if (eventName.value === 'common4') {
                premiumModal.value = true;
                premiumImageSrc.value = iceCream
                premiumText.value = '백미당 아이스크림 1EA 쿠폰 교환권'
            }

            const imageObj = new Image();
            imageObj.src = imgData.value;
            imageObj.onload = () => {


                const imageHeight = window.innerHeight * 0.64;
                const imageWidth = imageHeight * 0.75

                stage = new Konva.Stage({
                    container: konvaContainer.value,
                    width: imageWidth,
                    height: imageHeight,
                });

                layer = new Konva.Layer();
                drawingLayer = new Konva.Layer();

                stage.add(layer);
                stage.add(drawingLayer);

                const konvaImage = new Konva.Image({
                    x: 0,
                    y: 0,
                    image: imageObj,
                    width: imageWidth,
                    height: imageHeight,
                });

                layer.add(konvaImage);
                layer.draw();

                addHistory();

                stage.on('mousedown touchstart', (e) => {
                    if (currentTool.value === 'draw' || currentTool.value === '지우개') {
                        startDrawing(e);
                    }
                });

                stage.on('mouseup touchend', () => {
                    endDrawing();
                });

                stage.on('mousemove touchmove', (e) => {
                    draw(e);
                });

            };
        });

        return {
            index,
            imgData,
            saveImage,
            back,
            showFooter2,
            toggleFooter2,
            share,
            showModal,
            confirmBack,
            closeModal,
            konvaContainer,
            currentTool,
            colors,
            activateTool,
            setColor,
            showToolbox,
            setDrawingTool,
            drawComplete,
            addText,
            setTextTool,
            undo,
            redo,
            premiumModal,
            next,
            bgClick,
            currentDrawingTool,
            currentTextTool,
            premiumImageSrc,
            premiumText,
            editor,
        }
    }
}
</script>

<style scoped>
@import url('https://cdn.rawgit.com/moonspam/NanumSquare/master/nanumsquare.css');

.konva-container {
    touch-action: pan-x pan-y;
    width: 100%;
    display: flex;
    object-fit: cover;
    justify-content: center;
    background-color: #565656;
}

.footer {
    height: calc(26 * var(--vh));
    width: 100%;
    background-color: #fff;
    color: #fff;
    display: grid;
    grid-template-columns: repeat(3, 2fr);
    align-items: center;
    justify-content: center;
}

.footer button {
    margin: 0;
    padding: 0;
    background-color: #fff;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    flex-direction: column;
    color: var(--Text-Gray, #767676);
    text-align: center;
    font-family: NanumSquare;
    font-size: 12px;
    font-style: normal;
    font-weight: 700;
    line-height: 14px;
    letter-spacing: -0.3px;
}

.footer button:hover {
    background-color: #777;
}

.top-section {
    display: flex;
    flex-direction: row;
    width: 100%;
    height: calc(10 * var(--vh));
    justify-content: center;
    align-items: center;
    z-index: 1;
    background: var(--Main-Pink, #F0D7CA);
}


.side-image-container {
    display: flex;
    align-items: center;
    position: absolute;
    left: 5vw;
}

.side-image-container button {
    height: 100%;
    width: 100%;
    display: block;
    border: none;
    background: none;
    outline: none;
}

.text-container1 {
    justify-content: center;
    align-items: center;
}



.text-container1 p {
    color: var(--Text-Black, #111);
    font-family: "NanumSquare", sans-serif;
    font-size: 20px;
    font-style: normal;
    font-weight: 700;
    line-height: 28px;
    letter-spacing: -0.5px;
}

.footer2 {
    position: fixed;
    bottom: 0;
    height: calc(30 * var(--vh));
    width: 100%;
    background-color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 2;
}

.footer2 p {
    color: var(--Text-Black, #111);
    text-align: center;
    font-family: "NanumSquare", sans-serif;
    font-size: 20px;
    font-style: normal;
    font-weight: 800;
    line-height: 28px;
    letter-spacing: -0.5px;
}

.footer2 button {
    width: 80%;
    padding: 10px;
    margin-top: 5px;
    border-radius: 16px;
    background: var(--Main-Pink, #F0D7CA);
    border: none;
    color: #000;
    cursor: pointer;
}

.footer2 button:last-child {
    width: 80%;
    padding: 10px;
    margin-top: 5px;
    border-radius: 16px;
    background: var(--Main-Pink, #d9d9d9);
    border: none;
    color: #000;
    cursor: pointer;
}

.footer2 button p {
    color: var(--Text-Black, #111);
    text-align: center;
    font-family: "NanumSquare", sans-serif;
    font-size: 16px;
    font-style: normal;
    font-weight: 700;
    line-height: 24px;
    letter-spacing: -0.4px;
}

.modal {
    position: fixed;
    top: 50%;
    left: 50%;
    width: 60%;
    height: calc(10 * var(--vh));
    display: flex;
    align-items: center;
    justify-content: space-between;
    border: none;
    background-color: #fff;
    border-radius: 16px;
    flex-direction: column;
    z-index: 3;
    padding-top: 10%;
    transform: translate(-50%, -50%);
}

.modal p {
    color: #111;
    text-align: center;
    font-family: "NanumSquare", sans-serif;
    font-size: 15px;
    font-style: normal;
    font-weight: 800;
    line-height: 28px;
    letter-spacing: -0.5px;
}

.modal-buttons {
    margin-top: 10%;
    display: flex;
    justify-content: center;
    width: 100%;
}

.modal button {
    width: 50%;
    padding: 10px;
    border: none;
    cursor: pointer;
}



.modal button:first-child {
    border-radius: 0px 0px 0px 16px;
    background: var(--Background_Grey, #D9D9D9);
    color: var(--Text-Gray, #767676);
    text-align: center;
    font-family: "NanumSquare", sans-serif;
    font-size: 16px;
    font-style: normal;
    font-weight: 700;
    line-height: 24px;
    letter-spacing: -0.4px;
}

.modal button:last-child {
    border-radius: 0px 0px 16px 0px;
    background: var(--Main-Pink, #F0D7CA);
    color: var(--Text-Black, #111);
    text-align: center;
    font-family: "NanumSquare", sans-serif;
    font-size: 16px;
    font-style: normal;
    font-weight: 700;
    line-height: 24px;
    letter-spacing: -0.4px;
}

.modal2 {
    position: fixed;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    top: 0%;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5)
}

.modal-content2 {
    position: fixed;
    top: calc(40 * var(--vh));
    left: 50%;
    width: 90vw;
    height: 90vw;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #fff;
    border-radius: 16px;
    flex-direction: column;
    z-index: 3;
    transform: translate(-50%, -50%);
}

.modal-content2 img {
    pointer-events: none;
    position: absolute;
    top: calc(1* var(--vh));
    width: auto;
    height: 70%;
}

.p1 {
    position: absolute;
    top: 70%;
    color: var(--Text-Black, #111);
    text-align: center;
    font-family: "NanumSquare", sans-serif;
    font-size: 20px;
    font-style: normal;
    font-weight: 800;
    line-height: 28px;
    letter-spacing: -0.5px;
}

.p2 {
    position: absolute;
    top: 80%;
    color: var(--Point-REd, var(--Point-Red, #D50F4A));
    text-align: center;
    font-family: "NanumSquare", sans-serif;
    font-size: 20px;
    font-style: normal;
    font-weight: 800;
    line-height: 28px;
    letter-spacing: -0.5px;
}


.close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: transparent;
    border: none;
    font-size: 24px;
    cursor: pointer;
    outline: none;
}

.toolbox {
    background-color: #fff;
    width: 100%;
    height: calc(30 * var(--vh));
    display: flex;
    flex-direction: column;
    position: absolute;
    bottom: 0;
}


.top-section2 {
    display: flex;
    flex: 1;
}

.left {
    width: 20%;
    height: calc(20 * var(--vh));
    display: flex;
    flex-direction: column;
    justify-content: space-evenly;
}

.left button {
    border: none;
    background: none;
    outline: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--Text-Gray, #767676);
    text-align: center;
    font-size: 10px;
    font-style: normal;
    font-weight: 700;
    line-height: 12px;
    letter-spacing: -0.25px;
    font-family: "NanumSquare", sans-serif;
}

.left button.active {
    color: #000
}

.left button svg path {
    fill-opacity: 0.3;
}


.left button.active svg path {
    fill-opacity: 1;
}

.right {
    width: 80%;
}

.right button {
    display: flex;
    align-items: center;
}


.top-buttons {
    height: calc(10 * var(--vh));
    display: flex;
    justify-content: space-evenly;
}

.bottom-buttons {
    width: 100%;
    height: 10vh;
    display: flex;
    justify-content: space-around;
    padding-left: 1%;
}

.bottom-buttons button:not(:last-child) {
    margin-right: 10px;

}

.top-buttons button,
.bottom-buttons button {
    border: none;
    background: none;
    outline: none;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: "NanumSquare", sans-serif;
    color: var(--Text-Gray, #767676);
    text-align: center;
    font-size: 10px;
    font-style: normal;
    font-weight: 700;
    line-height: 12px;
    letter-spacing: -0.25px;
}

.top-buttons button.active {
    color: #000
}

.top-buttons button svg path {
    fill-opacity: 0.3;
}


.top-buttons button.active svg path {
    fill-opacity: 1;
}


.color-palette {
    height: calc(10 * var(--vh));
    display: flex;
    flex-direction: column;
    align-items: center;
}

.color-row {
    display: flex;
}

.color-row div {
    width: 40px;
    height: 30px;
    border: 1px solid #000;
    cursor: pointer;
}

.bottom-buttons .right-button {
    margin-left: 50%;

}

.image-container2 {
    width: 80%;
    height: calc(50 * var(--vh));
    display: flex;
    justify-content: space-evenly;
    align-items: center;
    margin-top: calc(25 * var(--vh));
}

.reward-container {
    position: relative;
    width: 100%;
    height: 100%;
    justify-content: center;
    display: flex;
}

.reward-container p {
    position: absolute;
    top: 60%;
    color: var(--Text-Black, #111);
    text-align: center;
    font-family: "NanumSquare", sans-serif;
    font-size: 16px;
    font-style: normal;
    font-weight: 800;
    line-height: 28px;
    letter-spacing: -0.5px;

}

.reward-container img:first-child {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.reward-container img:nth-child(2) {
    position: absolute;
    top: 0%;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    height: 80%;
}

.image-container2 button {
    position: absolute;
    width: 60.5%;
    height: calc(7.5 * var(--vh));
    top: calc(65 * var(--vh));
    border-radius: 0px 0px 16px 16px;
    border: none;
    background: var(--Main-Pink, #F0D7CA);
    color: var(--Text-Black, #111);
    text-align: center;
    font-family: "NanumSquare", sans-serif;
    font-size: 16px;
    font-style: normal;
    font-weight: 700;
    line-height: 24px;
    letter-spacing: -0.4px;

}
</style>